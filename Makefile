test: clean-test
	flake8 --ignore E501 malware_detection_client.py
	python -B -m pytest -v tests

test-client: clean-test
	python -B -m pytest -v tests/test_malware_detection_client.py

test-parse: clean-test
	python -B -m pytest -v tests/test_parse_scan_output.py

test-net: clean-test
	python -B -m pytest -v tests/test_network_functions.py

tests: test

clean:
	rm -rf build *egg-info*
	find . -name '*.pyc' -delete
	find . -type d -name '__pycache__' -delete

clean-test:
	find tests -name '*.pyc' -delete
	find tests -type d -name '__pycache__' -delete

clean-tests: clean-test

# Cause venv27 & venv36 to re-run pip install -r each time they are make'd
.PHONY: venv27 venv36

venv27:
	test -d venv27 || virtualenv venv27 --python /usr/bin/python2.7
	./venv27/bin/python -m pip install -r requirements.txt
	./venv27/bin/python -m pip install -r requirements-dev.txt

venv36:
	test -d venv36 || virtualenv venv36 --python /usr/bin/python3.6
	./venv36/bin/python -m pip install -r requirements.txt
	./venv36/bin/python -m pip install -r requirements-dev.txt
