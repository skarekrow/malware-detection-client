import os
import time

MTIME_DAYS = 1
RECENT_MTIME = time.time() - (MTIME_DAYS * 86400)  # 86400 seconds in a day


def is_recent_mtime(item):
    # Ignore links and other non-file types (eg pipes)
    if os.path.exists(item) and not os.path.islink(item) and os.path.isfile(item):
        return os.path.getmtime(item) > RECENT_MTIME
    return False


def walk_directory(directory, fd):
    """
    Walk a given directory and write filenames that have been modified recently to the given file handle
    """
    for root, dirs, files in os.walk(directory):
        for afile in files:
            path = os.path.join(root, afile)
            if is_recent_mtime(path):
                fd.write(path + "\n")


def walk_include_items(include_items, fd):
    """
    Walk a given list of items to include and write filenames that have been modified recently to the given file handle
    """
    for item in include_items:
        if os.path.isdir(item):
            walk_directory(item, fd)
        else:
            if is_recent_mtime(item):
                fd.write(item + '\n')
